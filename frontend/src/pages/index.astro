---
import Layout from "../layouts/Layout.astro";
import PostCard from "../components/PostCard.astro";
import PostForm from "../components/PostForm.astro";

const API_URL = import.meta.env.PUBLIC_API_URL;

interface Post { id: number; title: string; body: string; }

let posts: Post[] = [];
let error = null;

try {
  const response = await fetch(`${API_URL}/posts`);
  if (!response.ok) throw new Error("–û—à–∏–±–∫–∞ –ë—ç–∫–∞ üòí");
  const json = await response.json();
  posts = json.data; 
} catch (e) {
  error = "–°–æ—Å–∞—Ç—å —ç–ª–µ–∫—Å–∏—Ä, —Å–æ—Å–∞—Ç—å";
}
---

<Layout>
	<main class="min-h-screen bg-base-200">
		<!-- Hero Section -->
		<div class="hero bg-base-100 shadow-lg">
			<div class="hero-content text-center py-12">
				<div class="max-w-2xl">
					<h1 class="text-5xl font-bold bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent">
						–ù–∞—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –±–ª–æ–≥
					</h1>
					<p class="py-6 text-lg">
						–ü–æ–¥–µ–ª–∏—Ç–µ—Å—å —Å–≤–æ–∏–º–∏ –º—ã—Å–ª—è–º–∏ –∏ –∏–¥–µ—è–º–∏ —Å –º–∏—Ä–æ–º
					</p>
					<div class="stats shadow">
						<div class="stat">
							<div class="stat-figure text-primary">
								<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="inline-block w-8 h-8 stroke-current">
									<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"></path>
								</svg>
							</div>
							<div class="stat-title">–í—Å–µ–≥–æ –ø–æ—Å—Ç–æ–≤</div>
							<div class="stat-value text-primary">{posts.length}</div>
						</div>
					</div>
				</div>
			</div>
		</div>

		<div class="container mx-auto p-8 max-w-4xl">
			{error && (
				<div class="alert alert-error shadow-lg mb-8">
					<svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" />
					</svg>
					<span>{error}</span>
				</div>
			)}

			<PostForm />

			<div class="divider">–õ–ï–ù–¢–ê</div>

			<div class="space-y-6" id="posts">
				{posts.length === 0 && !error ? (
					<div class="hero min-h-[200px]">
						<div class="hero-content text-center">
							<div>
								<p class="text-lg opacity-60">üìù –ü–æ—Å—Ç–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</p>
								<p class="text-sm opacity-40 mt-2">–ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º, –∫—Ç–æ —Å–æ–∑–¥–∞—Å—Ç –ø–æ—Å—Ç!</p>
							</div>
						</div>
					</div>
				) : (
					posts.map((post, index) => (
						<div class="animate-fade-in" style={`animation-delay: ${index * 0.1}s`}>
							<PostCard post={post} />
						</div>
					))
				)}
			</div>
		</div>

		<!-- Footer -->
		<footer class="footer footer-center p-10 bg-base-100 text-base-content mt-20">
			<aside>
				<svg class="w-12 h-12 fill-current" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
					<path d="M12 2L2 7v10c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V7l-10-5z"/>
				</svg>
				<p class="font-bold">
					–ù–∞—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –±–ª–æ–≥
					<br/>
					<span class="text-sm opacity-60">Powered by Elixir + Astro</span>
				</p>
				<p class="text-xs opacity-60">¬© 2025 - –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã</p>
			</aside>
			<nav>
				<div class="grid grid-flow-col gap-4">
					<a class="link link-hover" href="#top">–ù–∞–≤–µ—Ä—Ö</a>
					<a class="link link-hover" href="#posts">–ü–æ—Å—Ç—ã</a>
				</div>
			</nav>
		</footer>
	</main>
</Layout>